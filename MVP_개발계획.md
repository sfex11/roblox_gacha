# MVP 개발 계획서 (Phase 0)

> **목표**: LLM 없이도 재미가 성립하는 가차 + 수집 + 협동 미니게임의 최소 플레이 가능 버전
> **기준 문서**: `가차게임계획.md` Phase 0 + 시장조사 성공 패턴

---

## 1. 프로젝트 구조

```
roblox_gacha/
├── README.md
├── MVP_개발계획.md
├── 가차게임계획.md
├── 가챠시장조사백업.md
└── src/
    ├── ReplicatedStorage/
    │   ├── Modules/
    │   │   ├── GachaConfig.lua        -- 확률 테이블/풀/희귀도 정의
    │   │   ├── ItemDatabase.lua       -- 아이템 템플릿 DB (ID/이름/스탯/모델)
    │   │   ├── SetDatabase.lua        -- 세트/도감 정의
    │   │   └── Constants.lua          -- 공용 상수 (재화 종류, 희귀도 enum 등)
    │   └── Assets/
    │       ├── Models/                -- 아이템/펫 모델 참조
    │       └── UI/                    -- UI 프리팹
    ├── ServerScriptService/
    │   ├── GachaService.lua           -- 가차 실행/확률 결정/지급 (SSOT)
    │   ├── InventoryService.lua       -- 인벤토리 CRUD / DataStore 연동
    │   ├── CodexService.lua           -- 도감/세트 진행도 관리
    │   ├── CurrencyService.lua        -- 재화 관리 (코인/티켓)
    │   ├── MinigameService.lua        -- 미니게임 매칭/진행/보상
    │   └── DataManager.lua            -- DataStore 래핑 (저장/로드/백업)
    ├── ServerStorage/
    │   └── Templates/                 -- 아이템 템플릿 원본 데이터
    └── StarterPlayer/
        └── StarterPlayerScripts/
            ├── GachaUI.lua            -- 가차 UI/연출 제어
            ├── InventoryUI.lua        -- 인벤토리/장착 UI
            ├── CodexUI.lua            -- 도감/세트 UI
            ├── HubUI.lua             -- 로비 HUD/네비게이션
            └── MinigameUI.lua         -- 미니게임 HUD
```

---

## 2. MVP 범위 정의

### 포함 (In-Scope)

| # | 기능 | 설명 |
|---|------|------|
| 1 | **가차 시스템** | 확률 테이블 기반 뽑기, 1연/10연, 프리셋 텍스트 |
| 2 | **아이템 템플릿** | 무기 5종 + 펫 5종 + 코스튬 5종 (총 15종, 희귀도별) |
| 3 | **인벤토리/장착** | 아이템 보관, 장착/해제, DataStore 영속 저장 |
| 4 | **도감/세트** | 획득 기록, 세트 1개 (테스트용), 세트 완성 보상 |
| 5 | **재화 시스템** | 코인(소프트) + 무료 티켓, 획득/소비 |
| 6 | **협동 미니게임** | 웨이브 디펜스 1종 (2~4인, 3분 이내) |
| 7 | **로비(허브)** | 가차 머신, 미니게임 입장, 기본 동선 |
| 8 | **가차 연출** | 희귀도별 이펙트 (브론즈~레인보우), 결과 카드 |

### 제외 (Out-of-Scope, Phase 1 이후)

- LLM 연동 (텍스트 생성)
- 프리미엄 가차 (Robux 과금)
- 강화/합성 시스템
- 천장/픽업 시스템
- 소셜 기능 (전광판/프로필 카드)
- 배틀패스/시즌 시스템

---

## 3. 개발 단계별 상세

### Step 1: 기반 구축 (데이터/저장)

**목표**: 게임 데이터 구조와 저장 시스템 완성

#### 1-1. 아이템 템플릿 DB 설계

```
ItemTemplate = {
    id            : string     -- "WEAPON_SWORD_FIRE_EPIC_01"
    category      : enum       -- Weapon / Pet / Costume
    rarity        : enum       -- Common / Rare / Epic / Legendary / Mythic
    name          : string     -- "홍염검" (프리셋)
    description   : string     -- "불꽃이 새겨진 검" (프리셋)
    flavorText    : string     -- "버그는 불태워야 한다"
    modelId       : string     -- 모델 에셋 참조
    stats         : {          -- 카테고리별 스탯
        attack?   : number,
        speed?    : number,
        coinBoost?: number,    -- 펫 전용
        -- ...
    }
    setId         : string?    -- 소속 세트 ID (없으면 nil)
}
```

#### 1-2. 가차 풀/확률 설정

```
GachaPool = {
    poolId   : "standard_pool_v1"
    items    : { templateId, weight }[]   -- 가중치 기반
    rarity_weights : {
        Common    = 6000,    -- 60%
        Rare      = 2500,    -- 25%
        Epic      = 1000,    -- 10%
        Legendary = 400,     -- 4%
        Mythic    = 100,     -- 1%
    }
}
```

**작동 방식**: 서버가 먼저 희귀도를 결정 → 해당 희귀도 내 아이템 중 가중치 랜덤 선택

#### 1-3. DataStore 스키마

```
PlayerData = {
    inventory : { [slotIndex] = { templateId, obtainedAt, enhanced? } }
    equipped  : { weapon?, pet?, costume? }
    codex     : { [templateId] = true }     -- 획득 이력
    sets      : { [setId] = completedCount }
    currency  : { coins = 0, tickets = 0 }
    stats     : { totalGachaPulls = 0, ... }
}
```

---

### Step 2: 가차 핵심 루프

**목표**: 재화 소비 → 확률 결정 → 아이템 지급까지의 서버 로직 완성

#### 2-1. GachaService (서버)

- `pullSingle(player, poolId)` → 티켓/코인 차감 → 희귀도 결정 → 아이템 선택 → 인벤토리 지급
- `pullMulti(player, poolId, count=10)` → 10연 뽑기 (할인/보너스 옵션)
- **검증**: 재화 부족/인벤토리 풀/중복 요청 방어
- **중복 처리**: 이미 보유 시 코인으로 자동 전환 (MVP에서는 단순 코인 변환)

#### 2-2. RemoteEvent 통신

```
Client → Server:
  "RequestGachaPull" { poolId, pullType = "single" | "multi" }

Server → Client:
  "GachaPullResult" {
      success,
      items = { {templateId, rarity, isNew} ... },
      currencyAfter,
      inventoryUpdates
  }
```

#### 2-3. 확률 투명성 (정책 대응)

- 클라이언트에서 확률표 조회 가능: `"RequestOddsTable"` → 서버가 현재 풀의 희귀도별 % 반환
- UI에 "확률 보기" 버튼 상시 배치

---

### Step 3: 인벤토리 / 장착 / 도감

**목표**: 아이템 관리와 수집 진행도 시스템

#### 3-1. InventoryService

- 추가/제거/조회
- 장착/해제 (카테고리당 1개)
- 인벤토리 슬롯 제한 (MVP: 50칸)

#### 3-2. CodexService

- 신규 아이템 획득 시 도감 자동 등록
- 세트 진행도 계산: `세트 내 보유 아이템 수 / 세트 전체 아이템 수`
- 세트 완성 시 보상 지급 (타이틀 텍스트 / 코인 보너스)

#### 3-3. 도감 UI

- 카테고리별 탭 (무기/펫/코스튬)
- 미획득 아이템은 실루엣 + "???" 표시
- 세트 진행도 바 + 보상 미리보기

---

### Step 4: 재화 시스템

**목표**: 코어 루프를 굴리는 경제 기초

| 재화 | 획득 | 사용 |
|------|------|------|
| **코인** | 미니게임 보상, 중복 아이템 분해 | 일반 가차 (100코인/1회) |
| **무료 티켓** | 일일 지급 (3장), 퀘스트 보상 | 가차 1회 (티켓 1장) |

- 일일 리셋: 서버 시간 기준 00:00 UTC
- MVP에서는 Robux 과금 재화 없음

---

### Step 5: 협동 미니게임

**목표**: "가차 동기"를 만드는 핵심 플레이 콘텐츠

#### 웨이브 디펜스 (MVP 미니게임)

- **인원**: 2~4인 (솔로도 가능하나 난이도 높음)
- **시간**: 3~5분 (3웨이브)
- **구조**:
  - Wave 1: 약한 몬스터 다수 → 코인 드랍
  - Wave 2: 중간 몬스터 + 미니보스 → 코인 + 티켓 확률 드랍
  - Wave 3: 보스 → 클리어 보상 (코인 대량 + 티켓 1장 확정)
- **장착 효과**: 무기 스탯 → 공격력, 펫 → 코인 드랍 증가
- **매칭**: 로비 내 "미니게임 포탈"에서 대기 → 2명 이상 시 시작

#### 보상 테이블

| 결과 | 코인 | 티켓 |
|------|------|------|
| Wave 1 클리어 | 30~50 | - |
| Wave 2 클리어 | 50~80 | 0~1 (30% 확률) |
| Wave 3 (보스) 클리어 | 100~150 | 1 (확정) |
| 올클리어 보너스 | +50 | - |

→ 풀클리어 시 약 230~330코인 + 티켓 1~2장
→ 일반 가차 2~3회 or 티켓 가차 1~2회 가능 → **1판에 최소 1뽑 보장**

---

### Step 6: 로비(허브) & UI

**목표**: 플레이어 동선과 핵심 UI 완성

#### 로비 레이아웃

```
┌─────────────────────────────────────┐
│           [미니게임 포탈]             │
│                                     │
│    [NPC: 퀘스트]    [가차 머신]       │
│                    (중앙, 강조)       │
│                                     │
│  [인벤토리 NPC]    [도감 NPC]        │
│                                     │
│           [스폰 포인트]              │
└─────────────────────────────────────┘
```

#### 필수 UI 목록

| UI | 진입점 | 핵심 요소 |
|----|--------|----------|
| 가차 | 가차 머신 인터랙션 | 1연/10연 버튼, 확률 보기, 보유 재화 |
| 가차 연출 | 가차 실행 후 | 캡슐 등장 → 희귀도 이펙트 → 아이템 카드 공개 |
| 인벤토리 | HUD 버튼 or NPC | 아이템 목록, 장착/해제, 정렬/필터 |
| 도감 | HUD 버튼 or NPC | 카테고리 탭, 세트 진행도, 보상 |
| 미니게임 HUD | 게임 진행 중 | 웨이브 표시, HP, 타이머, 킬 카운트 |
| 결과 화면 | 미니게임 종료 | 획득 코인/티켓, MVP 플레이어 |

---

### Step 7: 가차 연출

**목표**: 뽑기의 쾌감을 극대화하는 시각 연출

#### 연출 흐름 (1연 기준, ~3초)

```
1. [0.0s] 캡슐/알 등장 (바운스 애니메이션)
2. [0.5s] 흔들림 시작 (기대감 빌드업)
3. [1.5s] 금이 가며 빛 누출 (희귀도별 색상)
         - Common:    회색
         - Rare:      파란색
         - Epic:      보라색
         - Legendary: 금색 + 파티클
         - Mythic:    무지개 + 화면 쉐이크 + 특수 사운드
4. [2.0s] 파열 → 아이템 카드 등장
5. [2.5s] 이름/설명/희귀도 텍스트 페이드인
6. [3.0s] "NEW!" 뱃지 (신규) or "중복 → +50코인" 표시
```

#### 10연 연출

- 10개 캡슐 순차 등장 (0.3초 간격) → 스킵 버튼으로 즉시 결과 확인 가능
- 최고 희귀도 아이템은 마지막에 연출 강조

---

## 4. MVP 아이템 목록 (초기 15종)

### 무기 (5종)

| ID | 이름 | 희귀도 | 공격력 |
|----|------|--------|--------|
| WPN_SWORD_01 | 나무 검 | Common | 10 |
| WPN_BOW_01 | 사냥꾼의 활 | Rare | 18 |
| WPN_WAND_01 | 불꽃 완드 | Epic | 28 |
| WPN_KATANA_01 | 번개 카타나 | Legendary | 40 |
| WPN_STAFF_01 | 별의 지팡이 | Mythic | 55 |

### 펫 (5종)

| ID | 이름 | 희귀도 | 코인 부스트 |
|----|------|--------|------------|
| PET_CAT_01 | 아기 고양이 | Common | +5% |
| PET_DOG_01 | 골든 퍼피 | Rare | +10% |
| PET_DRAGON_01 | 꼬마 드래곤 | Epic | +18% |
| PET_PHOENIX_01 | 불사조 | Legendary | +28% |
| PET_UNICORN_01 | 무지개 유니콘 | Mythic | +40% |

### 코스튬 (5종)

| ID | 이름 | 희귀도 | 효과 |
|----|------|--------|------|
| CST_HOOD_01 | 모험가 후드 | Common | 트레일: 없음 |
| CST_ARMOR_01 | 기사 갑옷 | Rare | 트레일: 은빛 |
| CST_ROBE_01 | 마법사 로브 | Epic | 오라: 보라색 |
| CST_WING_01 | 천사 날개 | Legendary | 오라: 금색 |
| CST_AURA_01 | 우주 아우라 | Mythic | 오라: 무지개 |

### 세트 (MVP 테스트용 1개)

- **"초보 모험가 세트"**: WPN_SWORD_01 + PET_CAT_01 + CST_HOOD_01
  - 완성 보상: 타이틀 "첫 걸음" + 코인 500

---

## 5. 개발 우선순위 & 일정

```
Step 1: 기반 구축          ██████░░░░░░░░░░░░░░  데이터/저장
Step 2: 가차 핵심 루프      ░░░░░░██████░░░░░░░░  서버 로직
Step 3: 인벤토리/도감       ░░░░░░░░░░██████░░░░  수집 시스템
Step 4: 재화 시스템         ░░░░░░░░░░░░███░░░░░  경제 기초
Step 5: 협동 미니게임       ░░░░░░░░░░░░░░████░░  플레이 콘텐츠
Step 6: 로비 & UI          ░░░░░░░░░░░░░░░░████  화면/동선
Step 7: 가차 연출          ░░░░░░░░░░░░░░░░░░██  연출/폴리시
```

**의존 관계**:
- Step 2는 Step 1 완료 후
- Step 3, 4는 Step 2 완료 후 (병렬 가능)
- Step 5는 Step 1, 4 완료 후
- Step 6은 Step 2, 3 완료 후
- Step 7은 Step 2 완료 후 (UI와 병렬 가능)

---

## 6. MVP 완료 기준 (Definition of Done)

- [ ] 가차 머신에서 1연/10연 뽑기가 정상 작동
- [ ] 확률표가 UI에서 확인 가능
- [ ] 아이템이 인벤토리에 저장되고 장착/해제 가능
- [ ] 도감에 획득 기록이 남고 세트 진행도 표시
- [ ] 코인/티켓으로 가차 실행 가능
- [ ] 웨이브 디펜스 미니게임 1판 완주 가능 (2~4인)
- [ ] 미니게임 클리어 시 코인/티켓 지급
- [ ] 데이터가 세션 간 유지 (DataStore)
- [ ] 희귀도별 가차 연출이 구분됨
- [ ] **코어 루프 1바퀴**: 미니게임 → 재화 획득 → 가차 → 아이템 장착 → 미니게임

---

## 7. Phase 1 준비사항 (MVP 이후)

MVP가 완성되면 다음을 순차적으로 추가:

1. **백엔드 API 서버** 구축 (LLM 연동용)
2. **LLM 텍스트 생성** 연동 (이름/설명/플레이버)
3. **프리미엄 가차** + 확률 공개 UI + PolicyService 연동
4. **천장/픽업** 시스템
5. **강화/합성** 시스템
6. **시즌/이벤트** 운영 파이프라인
