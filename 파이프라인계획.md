# AI 기반 UGC 자동화 파이프라인 구현 계획

## 📋 프로젝트 개요

**목표**: 텍스트 프롬프트로 Roblox UGC 아이템 생성 파이프라인 구축

**파이프라인**: GLM-4.7 (텍스트 생성) → Blender (3D 모델링) → [수동 Import] → Studio Lua (메타데이터 설정)

**상태**: ✅ Phase 1-2 완료 (FBX 자동 생성), Phase 3 수동 작업 필요

---

## ⚠️ 중요: Roblox API 제약사항

**Roblox에는 프로그래밍 방식의 FBX Import API가 없습니다.**

- 모든 3D Import는 Studio에서 **수동으로 수행**해야 합니다
- Studio MCP는 `run_code`, `insert_model` 도구만 제공
- 따라서 완전 자동화는 불가능하며, **반자동 파이프라인**으로 구현합니다

---

## 🎯 단계별 구현 계획

### Phase 1: 백엔드 API 확장 ✅ 완료

#### 1.1 모델링 가이드 생성 API ✅
- [x] `backend/src/routes/modeling.js` - POST /api/modeling/guide
- [x] GLM-4.7로 구조화된 모델링 스펙 생성
- [x] 폴백 모드: GLM 타임아웃 시 기본 스펙 사용

#### 1.2 Blender 자동화 서비스 ✅
- [x] `backend/src/services/blenderService.js`
- [x] 백그라운드 Blender 실행 (spawn)
- [x] FBX 자동 내보내기

---

### Phase 2: Blender FBX 생성 ✅ 완료

#### 2.1 FBX 자동 생성 ✅
- [x] POST /api/modeling/generate - 전체 파이프라인
- [x] FBX 파일 자동 저장: `backend/exports/ugc/`
- [x] 생성된 FBX: 6개 파일 (각 18KB)

#### 2.2 Lua 스크립트 생성 ✅
- [x] Studio Import 후 사용할 Lua 스크립트 자동 생성
- [x] Import 가이드 포함

---

### Phase 3: Studio Import (수동 작업) ⚠️

#### 3.1 수동 Import 절차 ⚠️
- [ ] Roblox Studio 열기
- [ ] Avatar → Import 3D
- [ ] FBX 파일 선택
- [ ] Accessory Fitting Tool 실행

#### 3.2 Studio MCP (Lua 자동화만 가능) ✅
- [x] Studio MCP 설치 완료
- [x] `run_code` 도구로 Lua 실행 가능
- [x] **하지만 FBX Import는 수동 작업**

---

### Phase 4: Roblox 게임 통합 ✅ 완료

#### 4.1 UGCPipeline 모듈 ✅
- [x] `src/ServerScriptService/UGCPipeline.lua`
- [x] 백엔드 API 호출로 FBX 생성 요청
- [x] Import 가이드 제공

#### 4.2 관리자 명령어 ✅
- [x] `!ugc_make <프롬프트>` - FBX 생성 + 가이드 출력

---

## 📁 파일 구조

```
roblox_gacha/
├── backend/
│   ├── src/
│   │   ├── routes/
│   │   │   └── modeling.js          # ✅ Modeling API + Lua 생성
│   │   ├── services/
│   │   │   └── blenderService.js    # ✅ Blender 자동화
│   │   └── server.js                # ✅ 정적 파일 서빙
│   ├── exports/
│   │   └── ugc/                     # ✅ FBX 출력 폴더
│   │       ├── 귀여운_고양이_귀.fbx
│   │       ├── 빨간색_큐브_모자.fbx
│   │       ├── 초록색_구_모자.fbx
│   │       ├── 분홍색_하트_모자.fbx
│   │       ├── 보라색_박스.fbx
│   │       └── 주황색_박스.fbx
│   └── blender-scripts/
│       └── templates/               # ✅ 스크립트 템플릿
├── src/
│   └── ServerScriptService/
│       ├── UGCAutoUpload.lua        # ✅ Studio MCP 연동 (Placeholder)
│       ├── UGCPipeline.lua          # ✅ 전체 파이프라인 (반자동)
│       └── init.server.lua          # ✅ UGCPipeline 로드
├── ~/Documents/Roblox/StudioMCP/
│   ├── target/debug/
│   │   └── rbx-studio-mcp           # ✅ 실행 파일
│   └── Plugins/
│       └── MCPStudioPlugin.rbxm     # ✅ Studio 플러그인
└── 파이프라인계획.md                # 이 파일
```

---

## 🔄 실제 파이프라인 흐름

```
┌─────────────────────────────────────────────────────────────────────┐
│                   UGC 반자동 파이프라인                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [텍스트 입력]                                                       │
│       "귀여운 고양이 귀"                                              │
│            ↓                                                         │
│  ⚙️ Phase 1: GLM-4.7 (모델링 가이드) ✅ 자동화                        │
│     - 타임아웃 시 폴백 모드 사용                                     │
│            ↓                                                         │
│  ⚙️ Phase 2: Blender (FBX 생성) ✅ 자동화                            │
│     - 결과: backend/exports/ugc/ 폴더                                │
│            ↓                                                         │
│  👤 Phase 3: Studio Import ⚠️ 수동 작업                              │
│     1. Roblox Studio 열기                                            │
│     2. Avatar → Import 3D                                            │
│     3. FBX 파일 선택                                                 │
│     4. Accessory Fitting Tool 실행                                   │
│            ↓                                                         │
│  ⚙️ Phase 4: Lua 메타데이터 ✅ 자동화 가능                           │
│     - Studio MCP run_code로 스크립트 실행                            │
│            ↓                                                         │
│  [완료] Roblox UGC 아이템                                            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🔑 키 포인트

1. **자동화 가능**: GLM-4.7 → Blender → FBX 파일 생성 ✅
2. **수동 작업 필요**: FBX → Roblox Studio Import ⚠️
3. **Studio MCP 역할**: Lua 코드 실행으로 메타데이터 설정 ✅
4. **현실적인 접근**: 반자동 파이프라인으로 빠른 FBX 생성

---

## ⏱️ 실제 소요 시간

| Phase | 작업 | 예상 | 실제 |
|-------|------|------|------|
| 1 | 백엔드 API | 30분 | 30분 |
| 2 | Blender 연동 | 1시간 | 45분 |
| 3 | Studio MCP | 30분 | 30분 |
| 4 | 통합 파이프라인 | 1시간 | 30분 |
| **합계** | | **~3시간** | **~2.5시간** |

---

## 🚀 사용 방법

### 1. 백엔드 API로 FBX 생성

```bash
curl -X POST http://localhost:3001/api/modeling/generate \
  -H "Content-Type: application/json" \
  -H "X-Api-Secret: dev-secret" \
  -d '{
    "prompt": "귀여운 고양이 귀",
    "rarity": "Rare",
    "category": "Hat"
  }'
```

**응답:**
```json
{
  "success": true,
  "spec": { "name": "귀여운 고양이 귀", ... },
  "filename": "귀여운_고양이_귀.fbx",
  "fbxPath": ".../backend/exports/ugc/귀여운_고양이_귀.fbx",
  "studioLuaScript": "-- Studio에서 실행할 Lua 코드...",
  "importInstructions": { ... }
}
```

### 2. Roblox Studio에서 Import

1. Studio 열기
2. Avatar → **Import 3D**
3. 파일 선택: `backend/exports/ugc/[파일명].fbx`
4. **Accessory Fitting Tool** 실행

### 3. Lua 스크립트로 메타데이터 설정

응답에 포함된 `studioLuaScript`를 Studio Command Bar에서 실행

---

## 📝 다음 단계 (선택사항)

1. **GLM API 최적화**: 타임아웃 문제 해결
2. **Studio MCP 활용**: Import 후 Lua 자동 실행
3. **FBX 품질 개선**: Blender 스크립트 고도화
4. **웹 대시보드**: FBX 생성 요청 웹 UI
